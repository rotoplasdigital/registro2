"use strict";angular.module("myApp.view2",["ngRoute"]).config(["$routeProvider",function(o){o.when("/registroAdmin/:param1",{templateUrl:"view2/view2.html",controller:"View2Ctrl"}),o.when("/registroAdmin/",{templateUrl:"view2/view2.html",controller:"View2Ctrl"})}]).controller("View2Ctrl",["$scope","$http","$location","$routeParams","$route","MyService","zipcodesDirective",function(o,r,e,a,i,c,n){OpenPay.setId("mrraklv3chawdarks4lj"),OpenPay.setApiKey("pk_ec7053b34f294400af6f0da103aeef15");var t=OpenPay.deviceData.setup("processCard","deviceIdHiddenFieldName");if(o.promoValida=!1,o.checkout=!1,o.suges=[{nombre:"PURIFICADOR DE ALTA CAPACIDAD",precio:400,precioCompra:0,cantidad:1,idProducto:3,imagen:"./assets/purificador_de_alta_capacidad.png"},{nombre:"DISPENSADOR DE AGUA FRIA Y CALIENTE DE OSMOSIS INVERSA",precio:1102,precioCompra:0,cantidad:1,idProducto:8,imagen:"./assets/dispensador_agua_fria_caliente.jpg"},{nombre:"DISPENSADOR DE AGUA FRIA Y CALIENTE DE CARBÓN ACTIVADO",precio:928,precioCompra:0,cantidad:1,idProducto:7,imagen:"./assets/dispensador_agua_fria_caliente.jpg"},{nombre:"PURIFICADOR DE CARBÓN ACTIVADO CON PLATA COLOIDAL",precio:199,precioCompra:2400,cantidad:1,idProducto:2,imagen:"./assets/purificador_de_carbono-activado-con-planta-coloidal.png"},{nombre:"PURIFICADOR DE ÓSMOSIS INVERSA",precio:349,precioCompra:5500,cantidad:1,idProducto:4,imagen:"./assets/purificador_de_osmosis.png"},{nombre:"PURIFICADOR Y ALCALINIZADOR BAJO TARJA",precio:299,precioCompra:4800,cantidad:1,idProducto:5,imagen:"./assets/purificador_y_alcalinizador_bajo_tarja.png"},{nombre:"PURIFICADOR Y ALCALINIZADOR SOBRE TARJA",precio:399,precioCompra:7200,cantidad:1,idProducto:6,imagen:"./assets/purificador_y_alcalinizador_sobre_tarja.png"}],o.registro={},o.cargando=!1,o.textoBoton="Generar Pago",o.catalogo=[{nombre:"PURIFICADOR DE ALTA CAPACIDAD",precio:400,precioCompra:0,cantidad:1,idProducto:3,imagen:"./assets/purificador_de_alta_capacidad.png"},{nombre:"DISPENSADOR DE AGUA FRIA Y CALIENTE DE OSMOSIS INVERSA",precio:1102,precioCompra:0,cantidad:1,idProducto:8,imagen:"./assets/dispensador_agua_fria_caliente.jpg"},{nombre:"DISPENSADOR DE AGUA FRIA Y CALIENTE DE CARBÓN ACTIVADO",precio:928,precioCompra:0,cantidad:1,idProducto:7,imagen:"./assets/dispensador_agua_fria_caliente.jpg"},{nombre:"PURIFICADOR DE CARBÓN ACTIVADO CON PLATA COLOIDAL",precio:199,precioCompra:2400,cantidad:1,idProducto:2,imagen:"./assets/purificador_de_carbono-activado-con-planta-coloidal.png"},{nombre:"PURIFICADOR DE ÓSMOSIS INVERSA",precio:349,precioCompra:5500,cantidad:1,idProducto:4,imagen:"./assets/purificador_de_osmosis.png"},{nombre:"PURIFICADOR Y ALCALINIZADOR BAJO TARJA",precio:299,precioCompra:4800,cantidad:1,idProducto:5,imagen:"./assets/purificador_y_alcalinizador_bajo_tarja.png"},{nombre:"PURIFICADOR Y ALCALINIZADOR SOBRE TARJA",precio:399,precioCompra:7200,cantidad:1,idProducto:6,imagen:"./assets/purificador_y_alcalinizador_sobre_tarja.png"}],o.zipcode=n,o.logeado=!1,o.promociones=[],o.vendedores=[],a.param1)try{var s="'",d=new RegExp("'","g");o.registro=JSON.parse(a.param1.replace(d,'"'))}catch(o){console.log(o),alert("Información enviada invalida")}o.registro.suscripciones||(o.registro.suscripciones=[]),o.registro.cliente||(o.registro.cliente={nombre:null,apellido:null,email:null,telefono:null,tipoTelefono:null,telefono2:null,tipoTelefono2:null});var p={lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};o.descuento=0,r({url:"./back/clientes.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Login-Ajax-call":"true"},data:"action=getPromociones"}).success(function(r){1==r.success&&(o.promociones=r.root)}),r({url:"./back/clientes.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Login-Ajax-call":"true"},data:"action=traerVendedores"}).success(function(r){1==r.success&&(o.vendedores=r.root)}),$.fn.spin=function(o){return this.each(function(){var r=$(this),e=r.data();e.spinner&&(e.spinner.stop(),delete e.spinner),!1!==o&&(e.spinner=new Spinner($.extend({color:r.css("color")},o)).spin(this))}),this},o.hacerCheckout=function(){o.checkout=!0,setTimeout(function(){$("html, body").animate({scrollTop:$("#datosBasicos").offset().top},500)},200)},o.sacarSuma=function(r){for(var e=0,a=o.registro.suscripciones.length-1;a>=0;a--)o.registro.suscripciones[a].precioCompra||(e+=o.buscarPrecio(o.registro.suscripciones[a].idProducto)-o.buscarPrecio(o.registro.suscripciones[a].idProducto)*(o.descuento/100)),o.registro.suscripciones[a].precioCompra&&(e+=o.buscarPrecioCompra(o.registro.suscripciones[a].idProducto));return e},o.agregarCompra=function(r){var e=angular.copy(r);e.instalacion={},e.instalacion.codigoPostal=Number(o.sugZipCode),e.compraUnica=1,o.registro.suscripciones.push(e)},o.buscarPrecioCompra=function(r){return o.catalogo.find(function(o){return o.idProducto==r}).precioCompra},o.logearse=function(){r({url:"./back/clientes.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Login-Ajax-call":"true"},data:"action=logearse&email="+o.correo+"&password="+o.contrasena}).success(function(r){1==r.success?(o.logeado=!0,o.registro.vendedor=r.root[0].id):alert(r.messageText)})},o.agregarSuscripcion=function(r){var e=angular.copy(r);e.instalacion={},e.instalacion.codigoPostal=Number(o.sugZipCode),o.registro.suscripciones.push(e)},o.quitarProducto=function(r){o.registro.suscripciones.splice(r,1)},o.buscarImagen=function(r){return o.catalogo.find(function(o){return o.idProducto==r}).imagen},o.buscarNombre=function(r){return o.catalogo.find(function(o){return o.idProducto==r}).nombre},o.buscarPrecio=function(r){return o.catalogo.find(function(o){return o.idProducto==r}).precio},o.buscar=function(r){return o.catalogo.find(function(o){return o.idProducto==r})},$(document).on("click",".compra",function(){console.log("entro"),$("html, body").animate({scrollTop:$("#carrScroll").offset().top},500)}),o.isIgualInstalacion=function(){if(o.igualInstalacion)for(var r=0;r<o.registro.suscripciones.length;r++)o.registro.suscripciones[r].facturacion=angular.copy(o.registro.suscripciones[0].instalacion),o.registro.suscripciones[r].facturacion.notas=""},o.validarPromocion=function(){var r=o.promociones.find(function(r){return r.codigoPromocion==o.registro.codigoPromocion});return r?(o.diasPrueba=r.diasPrueba,o.descuento=r.descuento):(o.promoValida=!0,o.diasPrueba=0,o.descuento=0)},o.isMismaDireccion=function(){if(o.mismaDireccion)for(var r=0;r<o.registro.suscripciones.length;r++)o.registro.suscripciones[r].instalacion=angular.copy(o.registro.suscripciones[0].instalacion)},o.isMismaFacturacion=function(){if(o.mismaFacturacion)for(var r=0;r<o.registro.suscripciones.length;r++)o.registro.suscripciones[r].facturacion=angular.copy(o.registro.suscripciones[0].facturacion)},o.mismaDireccionLongitud=function(){return o.mismaDireccion?1:o.registro.suscripciones.length},o.mismaFacturacionLongitud=function(){return o.mismaFacturacion?1:o.registro.suscripciones.length},o.isRequiereFacturacion=function(){if(o.requiereFacturacion)return!0;for(var r=0;r<o.registro.suscripciones.length;r++)o.registro.suscripciones[r].facturacion=null;return!1},o.successCard=function(e){o.registro.tarjeta={},o.registro.tarjeta.nombre=e.data.card.holder_name,o.registro.tarjeta.numero=e.data.card.card_number,o.registro.tarjeta.marca=e.data.card.brand,o.registro.tarjeta.vigencia=e.data.card.expiration_month+"/"+e.data.card.expiration_year,o.registro.tarjeta.token=e.data.id,o.registro.tarjeta.session=t,r({url:"./back/clientes.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Login-Ajax-call":"true"},data:"action=addRegistro&registro="+JSON.stringify(o.registro)}).success(function(e){1==e.success?($("#orden").modal("show"),$("#preview1").spin(!1),o.cargando=!1,r({url:"./back/clientes.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Login-Ajax-call":"true"},data:"action=sendEmails&cliente="+o.registro.cliente.nombre+" "+o.registro.cliente.apellido+"&email="+o.registro.cliente.email+"&suscripciones="+JSON.stringify(o.registro.suscripciones)}).success(function(o){o.success})):(alert(e),o.textoBoton="Generar Pago",$("#preview1").spin(!1),o.cargando=!1)})},o.errorCard=function(r){o.errorTexto=r.message,o.errorTarjeta=!0,o.textoBoton="Generar Pago",$("#preview1").spin(!1),o.cargando=!1},o.hacerPedido=function(){o.errorTarjeta=!1,o.textoBoton="Cargando...",$("#preview1").spin(),o.cargando=!0,OpenPay.token.extractFormAndCreate($("#processCard"),o.successCard,o.errorCard)},o.buscarZipCode=function(r){var e=o.zipcode.find(function(o){return o.code==r});if(e)return o.suges=e.sugerencia;o.suges=[{nombre:"PURIFICADOR DE ALTA CAPACIDAD",precio:400,precioCompra:0,cantidad:1,idProducto:3,imagen:"./assets/purificador_de_alta_capacidad.png"},{nombre:"DISPENSADOR DE AGUA FRIA Y CALIENTE DE OSMOSIS INVERSA",precio:1102,precioCompra:0,cantidad:1,idProducto:8,imagen:"./assets/dispensador_agua_fria_caliente.jpg"},{nombre:"DISPENSADOR DE AGUA FRIA Y CALIENTE DE CARBÓN ACTIVADO",precio:928,precioCompra:0,cantidad:1,idProducto:7,imagen:"./assets/dispensador_agua_fria_caliente.jpg"},{nombre:"PURIFICADOR DE CARBÓN ACTIVADO CON PLATA COLOIDAL",precio:199,precioCompra:2400,cantidad:1,idProducto:2,imagen:"./assets/purificador_de_carbono-activado-con-planta-coloidal.png"},{nombre:"PURIFICADOR DE ÓSMOSIS INVERSA",precio:349,precioCompra:5500,cantidad:1,idProducto:4,imagen:"./assets/purificador_de_osmosis.png"},{nombre:"PURIFICADOR Y ALCALINIZADOR BAJO TARJA",precio:299,precioCompra:4800,cantidad:1,idProducto:5,imagen:"./assets/purificador_y_alcalinizador_bajo_tarja.png"},{nombre:"PURIFICADOR Y ALCALINIZADOR SOBRE TARJA",precio:399,precioCompra:7200,cantidad:1,idProducto:6,imagen:"./assets/purificador_y_alcalinizador_sobre_tarja.png"}]},o.recargar=function(){i.reload()}}]);