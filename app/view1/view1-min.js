"use strict";angular.module("myApp.view1",["ngRoute"]).config(["$routeProvider",function(r){r.when("/registro/:param1",{templateUrl:"view1/view1.html",controller:"View1Ctrl"}),r.when("/registro/",{templateUrl:"view1/view1.html",controller:"View1Ctrl"})}]).controller("View1Ctrl",["$scope","$http","$location","$routeParams","$route","MyService","zipcodesDirective",function(r,o,e,i,a,n,c){OpenPay.setId("mrraklv3chawdarks4lj"),OpenPay.setApiKey("pk_ec7053b34f294400af6f0da103aeef15");var t=OpenPay.deviceData.setup("processCard","deviceIdHiddenFieldName");if(r.suges=[],r.registro={},r.registro.vendedor=null,r.cargando=!1,r.promoValida=!1,r.checkout=!1,r.textoBoton="Generar Pago",r.catalogo=[{nombre:"PURIFICADOR DE ALTA CAPACIDAD",precio:400,precioCompra:0,cantidad:1,idProducto:3,imagen:"./assets/purificador_de_alta_capacidad.png"},{nombre:"DISPENSADOR DE AGUA FRIA Y CALIENTE DE OSMOSIS INVERSA",precio:1102,precioCompra:0,cantidad:1,idProducto:8,imagen:"./assets/dispensador_agua_fria_caliente.jpg"},{nombre:"DISPENSADOR DE AGUA FRIA Y CALIENTE DE CARBÓN ACTIVADO",precio:928,precioCompra:0,cantidad:1,idProducto:7,imagen:"./assets/dispensador_agua_fria_caliente.jpg"},{nombre:"PURIFICADOR DE CARBÓN ACTIVADO CON PLATA COLOIDAL",precio:199,precioCompra:2400,cantidad:1,idProducto:2,imagen:"./assets/purificador_de_carbono-activado-con-planta-coloidal.png"},{nombre:"PURIFICADOR DE ÓSMOSIS INVERSA",precio:349,precioCompra:5500,cantidad:1,idProducto:4,imagen:"./assets/purificador_de_osmosis.png"},{nombre:"PURIFICADOR Y ALCALINIZADOR BAJO TARJA",precio:299,precioCompra:4800,cantidad:1,idProducto:5,imagen:"./assets/purificador_y_alcalinizador_bajo_tarja.png"},{nombre:"PURIFICADOR Y ALCALINIZADOR SOBRE TARJA",precio:399,precioCompra:7200,cantidad:1,idProducto:6,imagen:"./assets/purificador_y_alcalinizador_sobre_tarja.png"}],r.zipcode=c,console.log("$scope.zipcode",r.zipcode),r.promociones=[],i.param1)try{var s="'",u=new RegExp("'","g");r.registro=JSON.parse(i.param1.replace(u,'"'))}catch(r){console.log(r),alert("Información enviada invalida")}r.registro.suscripciones||(r.registro.suscripciones=[]),r.registro.cliente||(r.registro.cliente={nombre:null,apellido:null,email:null,telefono:null,tipoTelefono:null,telefono2:null,tipoTelefono2:null});var d={lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};r.descuento=0,o({url:"./back/clientes.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Login-Ajax-call":"true"},data:"action=getPromociones"}).success(function(o){1==o.success&&(r.promociones=o.root)}),$.fn.spin=function(r){return this.each(function(){var o=$(this),e=o.data();e.spinner&&(e.spinner.stop(),delete e.spinner),!1!==r&&(e.spinner=new Spinner($.extend({color:o.css("color")},r)).spin(this))}),this},r.hacerCheckout=function(){r.checkout=!0,setTimeout(function(){$("html, body").animate({scrollTop:$("#datosBasicos").offset().top},500)},200)},r.sacarSuma=function(o){for(var e=0,i=r.registro.suscripciones.length-1;i>=0;i--)r.registro.suscripciones[i].precioCompra||(e+=r.buscarPrecio(r.registro.suscripciones[i].idProducto)-r.buscarPrecio(r.registro.suscripciones[i].idProducto)*(r.descuento/100)),r.registro.suscripciones[i].precioCompra&&(e+=r.buscarPrecioCompra(r.registro.suscripciones[i].idProducto));return e},r.agregarSuscripcion=function(o){var e=angular.copy(o);e.instalacion={},e.instalacion.codigoPostal=Number(r.sugZipCode),e.compraUnica=0,r.registro.suscripciones.push(e)},r.agregarCompra=function(o){var e=angular.copy(o);e.instalacion={},e.instalacion.codigoPostal=Number(r.sugZipCode),e.compraUnica=1,r.registro.suscripciones.push(e)},r.quitarProducto=function(o){r.registro.suscripciones.splice(o,1)},$(document).on("click",".compra",function(){console.log("entro"),$("html, body").animate({scrollTop:$("#carrScroll").offset().top},500)}),r.buscarNombre=function(o){return r.catalogo.find(function(r){return r.idProducto==o}).nombre},r.buscarImagen=function(o){return r.catalogo.find(function(r){return r.idProducto==o}).imagen},r.buscarPrecio=function(o){return r.catalogo.find(function(r){return r.idProducto==o}).precio},r.buscarPrecioCompra=function(o){return r.catalogo.find(function(r){return r.idProducto==o}).precioCompra},r.buscar=function(o){return r.catalogo.find(function(r){return r.idProducto==o})},r.validarPromocion=function(){var o=r.promociones.find(function(o){return o.codigoPromocion==r.registro.codigoPromocion});return o?(r.diasPrueba=o.diasPrueba,r.descuento=o.descuento):(r.promoValida=!0,r.diasPrueba=0,r.descuento=0)},r.isMismaDireccion=function(){if(r.mismaDireccion)for(var o=0;o<r.registro.suscripciones.length;o++)r.registro.suscripciones[o].instalacion=angular.copy(r.registro.suscripciones[0].instalacion)},r.isMismaFacturacion=function(){if(r.mismaFacturacion)for(var o=0;o<r.registro.suscripciones.length;o++)r.registro.suscripciones[o].facturacion=angular.copy(r.registro.suscripciones[0].facturacion)},r.isIgualInstalacion=function(){if(r.igualInstalacion)for(var o=0;o<r.registro.suscripciones.length;o++)r.registro.suscripciones[o].facturacion=angular.copy(r.registro.suscripciones[0].instalacion),r.registro.suscripciones[o].facturacion.notas=""},r.mismaDireccionLongitud=function(){return r.mismaDireccion?1:r.registro.suscripciones.length},r.mismaFacturacionLongitud=function(){return r.mismaFacturacion?1:r.registro.suscripciones.length},r.isRequiereFacturacion=function(){if(r.requiereFacturacion)return!0;for(var o=0;o<r.registro.suscripciones.length;o++)r.registro.suscripciones[o].facturacion=null;return!1},r.successCard=function(e){r.registro.tarjeta={},r.registro.tarjeta.nombre=e.data.card.holder_name,r.registro.tarjeta.numero=e.data.card.card_number,r.registro.tarjeta.marca=e.data.card.brand,r.registro.tarjeta.vigencia=e.data.card.expiration_month+"/"+e.data.card.expiration_year,r.registro.tarjeta.token=e.data.id,r.registro.tarjeta.session=t,o({url:"./back/clientes.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Login-Ajax-call":"true"},data:"action=addRegistro&registro="+JSON.stringify(r.registro)}).success(function(e){1==e.success?($("#orden").modal("show"),$("#preview1").spin(!1),r.cargando=!1,o({url:"./back/clientes.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Login-Ajax-call":"true"},data:"action=sendEmails&cliente="+r.registro.cliente.nombre+" "+r.registro.cliente.apellido+"&email="+r.registro.cliente.email+"&suscripciones="+JSON.stringify(r.registro.suscripciones)}).success(function(r){r.success})):(alert(e),r.textoBoton="Generar Pago",$("#preview1").spin(!1),r.cargando=!1)})},r.errorCard=function(o){r.errorTexto=o.message,r.errorTarjeta=!0,r.textoBoton="Generar Pago",$("#preview1").spin(!1),r.cargando=!1},r.hacerPedido=function(){r.errorTarjeta=!1,r.textoBoton="Cargando...",$("#preview1").spin(),r.cargando=!0,OpenPay.token.extractFormAndCreate($("#processCard"),r.successCard,r.errorCard)},r.buscarZipCode=function(o){var e=r.zipcode.find(function(r){return r.code==o});if(e)return r.suges=e.sugerencia;r.suges=[]},r.recargar=function(){a.reload()}}]);